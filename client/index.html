<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kios Chat - Inicio de SesiÃ³n</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="login-page">
    <!-- Notification div (oculto inicialmente, aparece desde arriba) -->
    <div id="kiosNotification" class="kios-notification"></div>
    <!-- Contenedor principal de login -->
    <div class="login-container" id="loginContainer">
      <div class="login-box">
        <!-- Logo y tÃ­tulo -->
        <div class="login-header">
          <div class="logo">ğŸ’­</div>
          <h1>Kios Chat</h1>
          <p>MensajerÃ­a en tiempo real</p>
        </div>

        <!-- Formulario de inicio de sesiÃ³n -->
        <form id="loginForm" class="login-form" style="display: block">
          <div class="form-group">
            <label for="username">
              <span class="input-icon">ğŸ‘¤</span>
              Nombre de Usuario
            </label>
            <input
              type="text"
              id="username"
              name="username"
              placeholder="Ingresa tu usuario"
              required
              minlength="3"
              maxlength="20"
              autocomplete="username"
              class="styled-input"
            />
          </div>

          <div class="form-group">
            <label for="password">
              <span class="input-icon">ğŸ”’</span>
              ContraseÃ±a
            </label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Ingresa tu contraseÃ±a"
              required
              minlength="4"
              autocomplete="current-password"
              class="styled-input"
            />
          </div>

          <button type="submit" class="btn-login">
            <span class="btn-icon">â¡ï¸</span>
            Iniciar SesiÃ³n
          </button>

          <div class="switch-mode">
            <p>
              Â¿No tienes cuenta?
              <a href="#" id="switchToRegister">RegÃ­strate aquÃ­</a>
            </p>
          </div>
        </form>

        <!-- Formulario de registro -->
        <form id="registerForm" class="login-form" style="display: none">
          <!-- Importante -->
          <div class="flex-form-container">
            <div>
              <div class="form-group">
                <label for="reg-username">
                  <span class="input-icon">ğŸ‘¤</span>
                  Nombre de Usuario
                </label>
                <input
                  type="text"
                  id="reg-username"
                  name="username"
                  placeholder="Elige tu usuario"
                  required
                  minlength="3"
                  maxlength="20"
                  class="styled-input"
                />
              </div>

              <div class="form-group">
                <label for="reg-password">
                  <span class="input-icon">ğŸ”’</span>
                  ContraseÃ±a
                </label>
                <input
                  type="password"
                  id="reg-password"
                  name="password"
                  placeholder="Crea una contraseÃ±a segura"
                  required
                  minlength="4"
                  class="styled-input"
                />
              </div>
            </div>

            <div>
              <div class="form-group">
                <label for="reg-avatar">
                  <span class="input-icon">ğŸ­</span>
                  Elige tu Avatar
                </label>
                <div class="avatar-selector" id="reg-avatar-selector">
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="ğŸ˜" checked />
                    <span class="avatar-icon">ğŸ˜</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="ğŸš€" />
                    <span class="avatar-icon">ğŸš€</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="âš¡" />
                    <span class="avatar-icon">âš¡</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="ğŸ®" />
                    <span class="avatar-icon">ğŸ®</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="ğŸ¯" />
                    <span class="avatar-icon">ğŸ¯</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="ğŸ”¥" />
                    <span class="avatar-icon">ğŸ”¥</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="â­" />
                    <span class="avatar-icon">â­</span>
                  </label>
                  <label class="avatar-option">
                    <input type="radio" name="avatar" value="ğŸ¸" />
                    <span class="avatar-icon">ğŸ¸</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <button type="submit" class="btn-login">
            <span class="btn-icon">âœ¨</span>
            Registrarse
          </button>

          <div class="switch-mode">
            <p>
              Â¿Ya tienes cuenta?
              <a href="#" id="switchToLogin">Inicia sesiÃ³n</a>
            </p>
          </div>
        </form>

        <!-- Mensaje de informaciÃ³n -->
        <!-- <div class="login-info">
          <p>ğŸ” Tus conversaciones estÃ¡n cifradas</p>
          <p>ğŸ’­ Chats privados y grupales</p>
          <p>âœ¨ MensajerÃ­a en tiempo real</p>
        </div> -->
      </div>
    </div>

    <!-- Socket.io client -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Script principal -->
    <script>
      // Conectar a Socket.io
      const socket = io();

      // Obtener elementos
      const loginForm = document.getElementById("loginForm");
      const loginContainer = document.getElementById("loginContainer");
      const registerForm = document.getElementById("registerForm");
      const loginHeader = document.querySelector(".login-header h1");
      const kiosNotification = document.getElementById("kiosNotification");

      // FunciÃ³n para mostrar notificaciones
      function showKiosNotification(message, duration = 3000) {
        kiosNotification.innerHTML = "<strong> ğŸ””" + message + "</strong>";
        kiosNotification.classList.add("show");

        setTimeout(() => {
          kiosNotification.classList.remove("show");
        }, duration);
      }

      // === CAMBIAR ENTRE LOGIN Y REGISTRO ===
      document
        .getElementById("switchToRegister")
        .addEventListener("click", (e) => {
          e.preventDefault();
          loginForm.style.display = "none";
          registerForm.style.display = "block";
          loginHeader.textContent = "âœ¨ Crear Cuenta";
          loginContainer.style.maxWidth = "800px";
        });

      document
        .getElementById("switchToLogin")
        .addEventListener("click", (e) => {
          e.preventDefault();
          loginForm.style.display = "block";
          registerForm.style.display = "none";
          loginHeader.textContent = "Kios Chat";
          loginContainer.style.maxWidth = "450px";
        });

      // === REGISTRO ===
      registerForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const username = document.getElementById("reg-username").value.trim();
        const password = document.getElementById("reg-password").value.trim();
        const selectedAvatar =
          document.querySelector(
            '#reg-avatar-selector input[name="avatar"]:checked'
          )?.value || "ğŸ˜";

        if (username.length < 3) {
          // alert("âŒ El nombre de usuario debe tener al menos 3 caracteres");
          showKiosNotification(
            "âŒ El nombre de usuario debe tener al menos 3 caracteres"
          );
          return;
        }

        if (password.length < 4) {
          // alert("âŒ La contraseÃ±a debe tener al menos 4 caracteres");
          showKiosNotification(
            "âŒ La contraseÃ±a debe tener al menos 4 caracteres"
          );
          return;
        }

        // Enviar registro al servidor
        socket.emit("register-user", {
          username,
          password,
          avatar: selectedAvatar,
        });

        socket.once("register-response", (data) => {
          if (data.success) {
            showKiosNotification(" Â¡Registro exitoso!");
            loginForm.style.display = "block";
            registerForm.style.display = "none";
            loginHeader.textContent = "Kios Chat";
            loginContainer.style.maxWidth = "450px";
            registerForm.reset();
          } else {
            showKiosNotification(
              "âŒ " + (data.message || "Error al registrar")
            );
          }
        });
      });

      // === INICIO DE SESIÃ“N ===
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        if (username.length < 3 || password.length < 4) {
          // alert("âŒ Credenciales invÃ¡lidas");
          showKiosNotification("Credenciales invÃ¡lidas");
          return;
        }

        // Enviar login al servidor
        socket.emit("login-user", {
          username,
          password,
        });

        socket.once("login-response", (data) => {
          if (data.success) {
            // Guardar datos en sessionStorage
            sessionStorage.setItem("kios_username", data.username);
            sessionStorage.setItem("kios_avatar", data.avatar);

            // Registrar conexiÃ³n activa
            socket.emit("register", {
              username: data.username,
              avatar: data.avatar,
            });

            // showKiosNotification("Â¡Bienvenido/a " + data.username + "!");

            // Redirigir al chat
            setTimeout(() => {
              window.location.href = "chat.html";
            }, 500);
          } else {
            // alert("âŒ " + (data.message || "Usuario o contraseÃ±a incorrectos"));
            showKiosNotification("Usuario o contraseÃ±a incorrectos");
          }
        });
      });
    </script>
  </body>
</html>
